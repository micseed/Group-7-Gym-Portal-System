<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <!-- Chart.js removed unless needed -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <title>Admin Dashboard - Manage Admins</title>
    <style>
        /* =============== Globals ============== */
        * {
            font-family: "Poppins", sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root {
            --blue: #203A93;
            --white: #fff;
            --gray: #f5f5f5;
            --black1: #222;
            --black2: #999;
            --primary-color: #3498db; /* Define theme colors used */
            --primary-hover: #2980b9;
            --secondary-color: #2ecc71;
            --secondary-hover: #27ae60;
            --danger-color: #e74c3c;
            --danger-hover: #c0392b;
            --warning-color: #f39c12;
            --warning-hover: #d35400;
            --text-dark: #34495e;
            --text-light: #7f8c8d;
            --card-bg: #ffffff;
            --border-color: #ecf0f1;
            --radius: 8px;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        body { min-height: 100vh; overflow-x: hidden; background-color: var(--gray); }
        .container-fluid { /* Use container-fluid to avoid conflict with nav's .container */
             position: relative;
             width: 100%;
         }

        /* =============== Navigation ================ */
        /* --- Standard Navigation Styles --- */
        .navigation { position: fixed; width: 300px; height: 100%; background: var(--blue); border-left: 10px solid var(--blue); transition: 0.5s; overflow: hidden; z-index: 100; }
        .navigation.active { width: 80px; }
        .navigation ul { position: absolute; top: 0; left: 0; width: 100%; padding-left: 0; }
        .navigation ul li { position: relative; width: 100%; list-style: none; border-top-left-radius: 30px; border-bottom-left-radius: 30px; }
        .navigation ul li:hover, .navigation ul li.hovered { background-color: var(--white); }
        .navigation ul li:nth-child(1) { margin-bottom: 40px; pointer-events: none; }
        .navigation ul li a { position: relative; display: block; width: 100%; display: flex; text-decoration: none; color: var(--white); }
        .navigation ul li:hover a, .navigation ul li.hovered a { color: var(--blue); }
        .navigation ul li a .icon { position: relative; display: block; min-width: 60px; height: 60px; line-height: 75px; text-align: center; }
        .navigation ul li a .icon ion-icon { font-size: 1.75rem; }
        .navigation ul li a .title { position: relative; display: block; padding: 0 10px; height: 60px; line-height: 60px; text-align: start; white-space: nowrap; }
        /* Curves */
        .navigation ul li:hover a::before, .navigation ul li.hovered a::before { content: ""; position: absolute; right: 0; top: -50px; width: 50px; height: 50px; background-color: transparent; border-radius: 50%; box-shadow: 35px 35px 0 10px var(--white); pointer-events: none; }
        .navigation ul li:hover a::after, .navigation ul li.hovered a::after { content: ""; position: absolute; right: 0; bottom: -50px; width: 50px; height: 50px; background-color: transparent; border-radius: 50%; box-shadow: 35px -35px 0 10px var(--white); pointer-events: none; }

        /* ===================== Main Layout ===================== */
        /* --- Standard Main Layout Styles --- */
        .main { position: absolute; width: calc(100% - 300px); left: 300px; min-height: 100vh; background: var(--white); transition: 0.5s; padding: 20px; /* Add padding to main area */ }
        .main.active { width: calc(100% - 80px); left: 80px; }

        /* ===================== Topbar ===================== */
        /* --- Standard Topbar Styles --- */
        .topbar { width: 103%; height: 60px; display: flex; align-items: center; padding: 0 10px; justify-content: space-between; background: var(--white); box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 99; margin: -20px -20px 20px -20px; /* Adjust margin to counter main padding */ }
        .toggle { position: relative; width: 60px; height: 60px; display: flex; justify-content: center; align-items: center; font-size: 2.5rem; cursor: pointer; color: var(--black1); flex-shrink: 0; }
        /* Search */
        .search-container { position: relative; flex-grow: 1; max-width: 600px; margin: 0 10px; }
        .search-container label { display: flex; align-items: center; width: 100%; border: 1px solid #ccc; border-radius: 15px; overflow: hidden; background: var(--white); position: relative; }
        #search-input { flex-grow: 1; padding: 10px 10px 10px 30px; border: none; outline: none; font-size: 16px; box-sizing: border-box; }
        .search-container label ion-icon { position: absolute; left: 8px; top: 50%; transform: translateY(-50%); font-size: 20px; color: #777; cursor: pointer; }
        #search-results { position: absolute; top: calc(100% + 2px); left: 0; right: 0; background-color: #fff; border: 1px solid #ccc; border-radius: 8px; margin-top: 2px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15); z-index: 110; display: none; overflow: hidden; max-height: 300px; overflow-y: auto; }
        #search-results ul { list-style: none; padding: 8px 0; margin: 0; }
        #search-results li { padding: 12px 16px; cursor: pointer; transition: background-color 0.2s ease; font-size: 1.0em; color: #333; }
        #search-results li:hover { background-color: #f5f5f5; color: #222; }
        /* Mail */
        .mail-container { position: relative; display: inline-block; margin: 0 5px; flex-shrink: 0; }
        #mail-icon-inbox { font-size: 25px; color: var(--blue); cursor: pointer; padding: 5px; }
        #mail-icon-inbox:hover { opacity: 0.8; }
        #unread-mail-badge { position: absolute; top: -2px; right: -2px; background-color: red; color: white; font-size: 11px; border-radius: 50%; width: 16px; height: 16px; text-align: center; line-height: 16px; display: none; pointer-events: none; }
        #inbox-preview { position: absolute; top: calc(100% + 10px); right: -10px; background-color: #f9f9f9; border: 1px solid #ccc; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); width: 280px; padding: 15px; display: none; z-index: 110; text-align: left; }
        #inbox-preview strong { display: block; margin-bottom: 5px; }
        .email-item { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 3px 0; }
        .email-item.sender { font-weight: bold; }
        .email-item.subject { color: #555; font-size: 0.9em; }
        #inbox-preview hr { margin: 8px 0; }
        #inbox-preview a { display: block; margin-top: 10px; font-size: 0.8em; text-align: right; color: #007bff; text-decoration: none; }
        /* Notification */
        .notification-container { position: relative; display: inline-block; margin: 0 5px; flex-shrink: 0; }
        #notification-icon { font-size: 25px; color: var(--blue); cursor: pointer; padding: 5px; }
        #notification-icon:hover { opacity: 0.8; }
        #notification-badge { position: absolute; top: -2px; right: -2px; background-color: orange; color: white; font-size: 11px; border-radius: 50%; width: 16px; height: 16px; text-align: center; line-height: 16px; display: block; pointer-events: none; }
        #notifications-dropdown { position: absolute; top: calc(100% + 10px); right: -10px; background-color: #f9f9f9; border: 1px solid #ccc; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); width: 280px; padding: 15px; display: none; z-index: 110; text-align: left; }
        #notifications-dropdown strong { display: block; margin-bottom: 5px; }
        .notification-item { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 3px 0; }
        .notification-item.title { font-weight: bold; margin-top: 5px; }
        .notification-item.message { color: #555; font-size: 0.9em; }
        #notifications-dropdown hr { margin: 8px 0; }
        #notifications-dropdown a { display: block; margin-top: 10px; font-size: 0.8em; text-align: right; color: #007bff; text-decoration: none; }
        /* User */
        .user-info { display: flex; align-items: center; margin-left: 10px; flex-shrink: 0; }
        .user-info .name { margin-right: 10px; font-weight: 500; white-space: nowrap; }
        .user { position: relative; min-width: 40px; width: 40px; height: 40px; border-radius: 50%; overflow: hidden; cursor: pointer; }
        .user img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }

        /* ======================= Manage Admins Page Specific Styles ====================== */
        .admin-content-area { /* Wrapper for the page content */
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
        }
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
        .dashboard-header h1 { color: var(--blue); margin: 0; font-size: 1.6rem; }
        .admin-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background-color: var(--card-bg); padding: 15px; border-radius: var(--radius); box-shadow: 0 1px 3px rgba(0,0,0,0.05); border-left: 4px solid var(--primary-color); }
        .stat-card h3 { margin: 0 0 5px 0; font-size: 0.9rem; color: var(--text-light); font-weight: 500; }
        .stat-number { font-size: 1.8rem; font-weight: 600; color: var(--text-dark); }
        .search-filter-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
        .search-box { display: flex; align-items: center; background-color: #fff; border: 1px solid #ddd; border-radius: 6px; padding: 0 5px 0 10px; flex-grow: 1; max-width: 450px; }
        .search-box input { padding: 10px 5px; border: none; outline: none; font-size: 1rem; width: 100%; }
        .search-box button { background: none; border: none; cursor: pointer; padding: 8px; color: var(--text-light); }
        .filter-box { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .filter-box select { padding: 9px 12px; border: 1px solid #ddd; border-radius: 6px; outline: none; font-size: 0.95rem; background-color: var(--white); }
        .bulk-actions { display: none; align-items: center; gap: 10px; margin-bottom: 15px; padding: 10px 15px; background-color: #f0f4f8; border-radius: 6px; border: 1px solid #d9e2ec; }
        .bulk-actions select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .bulk-actions button { padding: 8px 15px; background-color: var(--primary-color); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem; font-weight: 500; }
        .bulk-actions button:hover { background-color: var(--primary-hover); }
        .table-container { overflow-x: auto; margin-bottom: 20px; border: 1px solid var(--border-color); border-radius: var(--radius); }
        #admin-list { width: 100%; border-collapse: collapse; }
        #admin-list thead th { background-color: #f8f9fa; color: var(--text-dark); padding: 12px 15px; text-align: left; border-bottom: 2px solid var(--border-color); position: relative; font-weight: 600; white-space: nowrap; }
        .sortable { cursor: pointer; }
        .sortable::after { content: '↕'; position: absolute; right: 8px; color: #adb5bd; }
        .sortable.asc::after { content: '↑'; color: var(--primary-color); }
        .sortable.desc::after { content: '↓'; color: var(--primary-color); }
        #admin-list tbody tr:nth-child(even) { background-color: #fdfdfe; }
        #admin-list tbody tr:hover { background-color: #f1f5f9; }
        #admin-list tbody td { padding: 12px 15px; border-bottom: 1px solid var(--border-color); color: var(--text-dark); font-size: 0.95rem; }
        #admin-list tbody td:last-child { text-align: center; }
        .checkbox-cell { width: 40px; text-align: center; padding-right: 0 !important; }
        .custom-checkbox { position: relative; display: inline-block; width: 18px; height: 18px; background-color: var(--white); border: 1px solid #ccc; border-radius: 3px; cursor: pointer; vertical-align: middle; }
        .custom-checkbox input { opacity: 0; width: 0; height: 0; }
        .checkmark { position: absolute; top: 0; left: 0; height: 18px; width: 18px; background-color: transparent; border-radius: 3px; transition: all 0.2s ease; }
        .custom-checkbox input:checked ~ .checkmark { background-color: var(--primary-color); border: 1px solid var(--primary-color); }
        .checkmark:after { content: ""; position: absolute; display: none; left: 6px; top: 2px; width: 5px; height: 10px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg); }
        .custom-checkbox input:checked ~ .checkmark:after { display: block; }
        .status-badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 500; }
        .status-badge.active { background-color: #d1e7dd; color: #0f5132; } /* Green */
        .status-badge.inactive { background-color: #f8d7da; color: #842029; } /* Red */
        .status-badge.pending { background-color: #fff3cd; color: #664d03; } /* Yellow */
        .actions-container { display: flex; justify-content: center; gap: 8px; flex-wrap: nowrap; }
        .btn { padding: 7px 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 13px; transition: all 0.2s ease; font-weight: 500; }
        .icon-btn { display: inline-flex; align-items: center; gap: 4px; }
        .icon-btn svg { width: 14px; height: 14px; }
        .edit-btn { background-color: var(--primary-color); color: white; }
        .edit-btn:hover { background-color: var(--primary-hover); }
        .delete-btn { background-color: var(--danger-color); color: white; }
        .delete-btn:hover { background-color: var(--danger-hover); }
        .change-password-btn { background-color: var(--warning-color); color: white; }
        .change-password-btn:hover { background-color: var(--warning-hover); }
        .pagination { display: flex; justify-content: center; align-items: center; margin-top: 25px; gap: 5px; }
        .pagination button { padding: 8px 12px; border: 1px solid #ddd; background-color: #fff; cursor: pointer; border-radius: 4px; transition: all 0.2s ease; color: var(--text-dark); }
        .pagination button:hover, .pagination button.active { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        .pagination button:disabled { background-color: #f5f5f5; color: #aaa; cursor: not-allowed; border-color: #ddd; }
        #add-admin-button { display: inline-flex; align-items: center; gap: 5px; padding: 10px 18px; background-color: var(--secondary-color); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 500; transition: background-color 0.3s ease; text-decoration: none; }
        #add-admin-button:hover { background-color: var(--secondary-hover); }
        #add-admin-button svg { width: 18px; height: 18px; }

         /* Add/Edit Form Styles */
        #add-admin-form { display: none; background-color: var(--white); padding: 25px; margin-top: 25px; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--border-color); }
        .form-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
        .form-header h2 { margin: 0; color: var(--blue); font-size: 1.4rem; }
        .form-close { font-size: 24px; color: var(--text-light); cursor: pointer; background: none; border: none; padding: 0; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .form-group { margin-bottom: 0; /* Removed bottom margin as gap handles spacing */ }
        .form-group label { display: block; margin-bottom: 6px; color: #555; font-weight: 500; font-size: 0.95rem; }
        .form-group input[type="text"], .form-group input[type="email"], .form-group input[type="password"], .form-group select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 1rem; transition: border-color 0.3s ease; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2); }
        .error-message { color: var(--danger-color); margin-top: 5px; font-size: 13px; }
        .password-container { position: relative; }
        .toggle-password { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: var(--text-light); padding: 5px; }
        .password-strength { margin-top: 8px; font-size: 12px; color: #666; }
        .strength-meter { height: 5px; width: 100%; background-color: #eee; margin-top: 5px; border-radius: 3px; overflow: hidden; }
        .strength-meter-fill { height: 100%; width: 0; transition: width 0.3s ease, background-color 0.3s ease; }
        .strength-meter-fill.weak { width: 25%; background-color: #e74c3c; }
        .strength-meter-fill.medium { width: 50%; background-color: #f39c12; }
        .strength-meter-fill.strong { width: 75%; background-color: #f1c40f; } /* Yellow for strong */
        .strength-meter-fill.very-strong { width: 100%; background-color: #2ecc71; } /* Green for very strong */
        .permissions-container { margin-top: 20px; border: 1px solid #ddd; border-radius: 6px; padding: 15px; }
        .permissions-title { margin-bottom: 10px; color: var(--text-dark); font-weight: 600; }
        .permissions-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; }
        .permission-item { display: flex; align-items: center; gap: 8px; }
        .permission-item label { font-weight: normal; color: #444; cursor: pointer;}
        .permission-item input[type="checkbox"] { width: 16px; height: 16px; cursor: pointer; }
        .form-actions { margin-top: 25px; display: flex; justify-content: flex-end; gap: 10px; }
        .cancel-btn { background-color: #7f8c8d; color: white; padding: 10px 20px; }
        .cancel-btn:hover { background-color: #6c7a7d; }
        .save-btn { background-color: var(--secondary-color); color: white; padding: 10px 20px; }
        .save-btn:hover { background-color: var(--secondary-hover); }

        /* Activity Log Accordion */
        .activity-log { margin-top: 30px; border: 1px solid var(--border-color); border-radius: var(--radius); overflow: hidden; }
        .accordion-header { background-color: #f8f9fa; padding: 12px 15px; font-weight: 600; color: var(--text-dark); cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); }
        .accordion-header svg { transition: transform 0.3s ease; }
        .accordion-header.active svg { transform: rotate(180deg); }
        .accordion-content { display: none; padding: 15px; background-color: var(--white); }
        .activity-item { padding: 10px 0; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 10px; }
        .activity-item:last-child { border-bottom: none; }
        .activity-icon { width: 30px; height: 30px; background-color: #e9f5ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary-color); flex-shrink: 0; }
        .activity-icon svg { width: 16px; height: 16px; }
        .activity-details { flex-grow: 1; font-size: 0.9rem; color: #555; }
        .activity-time { color: var(--text-light); font-size: 12px; display: block; margin-top: 3px; }

        /* =================== Modal Styles (Delete, Change Password, Sign Out) ================== */
        /* --- Standard Modal Styles --- */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal.show { display: flex; justify-content: center; align-items: center; animation: fadeInBg 0.3s ease-out; }
        .modal-content { background-color: #fefefe; margin: auto; padding: 25px; border: none; width: 90%; max-width: 500px; /* Default max-width */ border-radius: 8px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2); position: relative; animation: modalFadeIn 0.3s ease-out; max-height: 90vh; overflow-y: auto;} /* Added modal scroll */
        #signOutModal .modal-content { max-width: 450px; } /* Signout smaller */
        #change-password-modal .modal-content { max-width: 550px; } /* Password change slightly wider */
        .modal-header { padding-bottom: 15px; border-bottom: 1px solid #eee; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { font-size: 1.4rem; color: var(--blue); font-weight: 600; margin: 0; }
        .modal-body { font-size: 1rem; color: #555; margin-bottom: 25px; line-height: 1.6; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px; padding-top: 15px; border-top: 1px solid #eee; }
        .modal-button, .modal .btn { border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 500; transition: all 0.2s ease; }
        .modal-button.yes-button, .modal .delete-btn { background-color: #dc3545; color: white; }
        .modal-button.yes-button:hover, .modal .delete-btn:hover { background-color: #c82333; }
        .modal-button.no-button, .modal .cancel-btn { background-color: #6c757d; color: white; }
        .modal-button.no-button:hover, .modal .cancel-btn:hover { background-color: #5a6268; }
        .modal .save-btn { background-color: var(--secondary-color); color: white; } /* Save in modal */
        .modal .save-btn:hover { background-color: var(--secondary-hover); }
        .modal .close-button { font-size: 28px; font-weight: bold; color: #aaa; cursor: pointer; line-height: 1; background: none; border: none; padding: 0; }
        .modal .close-button:hover { color: #333; }

        /* Toast Notification */
        .toast { position: fixed; bottom: 20px; right: 20px; background-color: #333; color: white; padding: 15px 20px; border-radius: 5px; display: flex; align-items: center; gap: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.2); transform: translateY(120%); opacity: 0; transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); z-index: 1500; }
        .toast.show { transform: translateY(0); opacity: 1; }
        .toast.success { background-color: var(--secondary-color); }
        .toast.error { background-color: var(--danger-color); }
        .toast.warning { background-color: var(--warning-color); color: #333; } /* Warning text color */
        .toast .close-toast { background: none; border: none; color: inherit; font-size: 18px; cursor: pointer; margin-left: auto; padding: 0 5px; opacity: 0.8; }
        .toast .close-toast:hover { opacity: 1; }

        /* =================== Responsive Design ================== */
        @media (max-width: 991px) {
            .navigation { width: 80px; }
            .navigation.active { width: 300px; }
            .main { width: calc(100% - 80px); left: 80px; }
            .main.active { width: calc(100% - 300px); left: 300px; }
            .search-container { max-width: 400px; }
            #admin-list { min-width: 750px; }
        }
        @media (max-width: 768px) {
            .navigation { left: -300px; width: 300px; }
            .navigation.active { left: 0; width: 300px; }
            .main { width: 100%; left: 0; padding: 15px;}
            .main.active { width: 100%; left: 0; }
            .toggle { z-index: 101; color: var(--blue); }
            .topbar { margin: -15px -15px 15px -15px; padding: 0 10px;} /* Adjust margin for new padding */
            .search-container { max-width: 300px; }
            .user-info .name { display: none; }

            .admin-content-area { padding: 20px; }
            .dashboard-header h1 { font-size: 1.4rem; }
            .admin-stats { grid-template-columns: 1fr; } /* Stack stats */
            .search-filter-container { flex-direction: column; align-items: stretch; }
            .search-box { max-width: none; }
            .filter-box { justify-content: center;}
            .form-grid { grid-template-columns: 1fr; } /* Single column form */
            #admin-list { min-width: 650px; }
             #admin-list th, #admin-list td { padding: 10px 12px; font-size: 0.9rem; }
             .permissions-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
             .modal-content { max-width: 90%; }
        }
         @media (max-width: 600px) { /* Mobile table styles */
            #admin-list thead { display: none; }
            #admin-list tbody tr { display: block; margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 5px; padding: 10px; }
            #admin-list tbody td { display: block; width: 100%; text-align: right !important; /* Force right align */ padding-left: 40% !important; /* Space for label */ position: relative; border-bottom: 1px dashed #eee; padding-bottom: 8px; margin-bottom: 8px; }
             #admin-list tbody td:last-child { border-bottom: none; padding-bottom: 0; margin-bottom: 0;}
            #admin-list tbody td:before { content: attr(data-title); position: absolute; left: 10px; font-weight: 600; color: var(--text-dark); text-align: left; width: calc(40% - 20px); /* Adjust width */ }
            .actions-container { justify-content: flex-end; } /* Align buttons right */
            .checkbox-cell { padding-left: 10px !important; text-align: left !important;}
            .checkbox-cell::before { display: none;} /* Hide label for checkbox cell */
         }
        @media (max-width: 480px) {
             .topbar { padding: 5px 10px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; }
             .toggle { order: 1; flex-shrink: 0; }
             .mail-container, .notification-container, .user-info { order: 2; margin: 0 3px; flex-shrink: 0; }
             .search-container { order: 3; width: 100%; margin: 8px 0 5px 0; }
             .search-container label input { font-size: 14px; height: 36px; padding-left: 30px; }
             .search-container label ion-icon { font-size: 16px; left: 8px; }
             #search-results { top: calc(100% + 1px); width: 100%; left: 0; right: 0; }
             .user-info .name { display: none; }
             .user { width: 35px; height: 35px; min-width: 35px; }
             #mail-icon-inbox, #notification-icon { font-size: 22px; padding: 4px;}
             #unread-mail-badge, #notification-badge { width: 14px; height: 14px; line-height: 14px; font-size: 10px; top: -1px; right: -1px;}

             .admin-content-area { padding: 15px; }
             .dashboard-header h1 { font-size: 1.3rem; }
             #add-admin-button { font-size: 0.9rem; padding: 8px 12px; }
             .stat-card h3 { font-size: 0.85rem; }
             .stat-number { font-size: 1.6rem; }
             .filter-box select, .search-box input { font-size: 0.9rem; padding: 8px; }
             .bulk-actions span, .bulk-actions select, .bulk-actions button { font-size: 0.85rem; }
             #admin-list th, #admin-list td { padding: 8px 10px; font-size: 0.85rem; }
             .btn { font-size: 12px; padding: 6px 8px; }
             .pagination button { padding: 6px 10px; font-size: 0.9rem;}
             #add-admin-form { padding: 20px; }
             .form-group input, .form-group select { font-size: 0.95rem; padding: 8px;}
             .permissions-grid { grid-template-columns: 1fr;} /* Stack permissions */
             .modal-content { width: 95%; padding: 20px; }
             .modal-header h2 { font-size: 1.2rem; }
             .modal-body { font-size: 0.95rem; }
             .modal-button, .modal .btn { padding: 8px 15px; font-size: 0.9rem; }
        }
    </style>
</head>

<body>
    <div class="container-fluid"> <!-- Use container-fluid -->
        <div class="navigation">
            <ul>
                <li>
                    <a href="#">
                        <span class="icon"><ion-icon name="barbell"></ion-icon></span>
                        <span class="title">ENERGIZE</span>
                    </a>
                </li>
                 <li>
                    <a href="testadmin.html">
                        <span class="icon"><ion-icon name="home-outline"></ion-icon></span>
                        <span class="title">Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="adminclients.html">
                        <span class="icon"><ion-icon name="people-outline"></ion-icon></span>
                        <span class="title">Manage Clients</span>
                    </a>
                </li>
                <li>
                    <a href="admincoaches.html">
                        <span class="icon"><ion-icon name="people-outline"></ion-icon></span>
                        <span class="title">Manage Coaches</span>
                    </a>
                </li>
                <li>
                  <a href="adminguests.html">
                      <span class="icon"><ion-icon name="person-add-outline"></ion-icon></span>
                      <span class="title">Manage Guests</span>
                  </a>
              </li>

              <li><a href="adminmanage.html"><span class="icon"><ion-icon name="person-add-outline"></ion-icon></span><span class="title">Manage Admins</span></a></li>

                <li>
                    <a href="admincomplaint.html">
                        <span class="icon"><ion-icon name="chatbubble-outline"></ion-icon></span>
                        <span class="title">Complaints/Requests</span>
                    </a>
                </li>
                <li>
                    <a href="adminpayments.html">
                        <span class="icon"><ion-icon name="card-outline"></ion-icon></span>
                        <span class="title"> Clients Payments</span>
                    </a>
                </li>
                <li>
                    <a href="adminsettings.html">
                        <span class="icon"><ion-icon name="settings-outline"></ion-icon></span>
                        <span class="title">Settings</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="signOutLink"> <!-- Added ID -->
                        <span class="icon"><ion-icon name="log-out-outline"></ion-icon></span>
                        <span class="title">Sign Out</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- ========================= Main ==================== -->
        <div class="main">
            <div class="topbar">
                 <!-- Standard Topbar HTML -->
                 <div class="toggle">
                    <ion-icon name="menu-outline"></ion-icon>
                 </div>

                <div class="search-container">
                    <label>
                      <input type="text" id="search-input" placeholder="Search...">
                      <ion-icon name="search-outline"></ion-icon>
                    </label>
                    <div id="search-results"></div>
                </div>

                <div class="mail-container">
                    <ion-icon name="mail-outline" id="mail-icon-inbox"></ion-icon>
                    <div id="unread-mail-badge">1</div>
                    <div id="inbox-preview">
                        <strong>Inbox</strong><hr>
                        <div id="unread-messages">
                            <div class="email-item sender">IT Dept</div>
                            <div class="email-item subject">New Admin Access Granted</div><hr>
                        </div>
                        <div id="read-messages">
                           <div class="email-item sender">HR</div>
                           <div class="email-item subject">Role Definitions Update</div>
                        </div>
                        <a href="#">See All Mail</a>
                    </div>
                </div>

                <div class="notification-container">
                    <ion-icon name="notifications-outline" id="notification-icon"></ion-icon>
                    <div id="notification-badge">1</div>
                    <div id="notifications-dropdown">
                      <strong>Notifications</strong><hr>
                      <div id="notification-list">
                        <div class="notification-item title">Admin Added</div>
                        <div class="notification-item message">Jane Smith (Content Mgr) added.</div><hr>
                        </div>
                      <a href="#">See All Notifications</a>
                    </div>
                  </div>

                <div class="user-info">
                    <div class="name">Peter Pan</div>
                    <div class="user">
                        <img src="assets/img/ramburat.jpg" alt="User Avatar">
                    </div>
                </div>
            </div>

            <!-- ======================= Manage Admin Content ====================== -->
            <div class="admin-content-area">
                <div class="dashboard-header">
                    <h1>Admin Management</h1>
                    <button id="add-admin-button" class="icon-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line>
                        </svg>
                        Add New Admin
                    </button>
                </div>

                <div class="admin-stats">
                    <div class="stat-card">
                        <h3>Total Admins</h3>
                        <div class="stat-number" id="total-admins">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Active Admins</h3>
                        <div class="stat-number" id="active-admins">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Super Admins</h3>
                        <div class="stat-number" id="super-admins">0</div>
                    </div>
                </div>

                <div class="search-filter-container">
                    <div class="search-box">
                        <input type="text" id="admin-search" placeholder="Search admins by name, email, username...">
                        <button id="search-button" aria-label="Search">
                             <ion-icon name="search-outline"></ion-icon>
                        </button>
                    </div>
                    <div class="filter-box">
                        <select id="status-filter" aria-label="Filter by Status">
                            <option value="">All Statuses</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                        <select id="role-filter" aria-label="Filter by Role">
                            <option value="">All Roles</option>
                            <option value="superadmin">Super Admin</option>
                            <option value="contentmanager">Content Manager</option>
                            <option value="membermanager">Member Manager</option>
                            <option value="schedulemanager">Schedule Manager</option>
                        </select>
                    </div>
                </div>

                <div class="bulk-actions" id="bulk-actions">
                    <span>Selected: <span id="selected-count">0</span></span>
                    <select id="bulk-action-select" aria-label="Select Bulk Action">
                        <option value="">Choose Action</option>
                        <option value="activate">Activate</option>
                        <option value="deactivate">Deactivate</option>
                        <option value="delete">Delete</option>
                    </select>
                    <button id="apply-bulk-action">Apply</button>
                </div>

                <div class="table-container">
                    <table id="admin-list">
                        <thead>
                            <tr>
                                <th class="checkbox-cell">
                                    <label class="custom-checkbox select-all-container" title="Select All">
                                        <input type="checkbox" id="select-all">
                                        <span class="checkmark"></span>
                                    </label>
                                </th>
                                <th class="sortable" data-sort="name">Name</th>
                                <th class="sortable" data-sort="email">Email</th>
                                <th class="sortable" data-sort="username">Username</th>
                                <th class="sortable" data-sort="role">Role</th>
                                <th class="sortable" data-sort="status">Status</th>
                                <th class="sortable" data-sort="lastLogin">Last Login</th> <!-- Made sortable -->
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populated by JavaScript -->
                        </tbody>
                    </table>
                </div>

                <div class="pagination" id="pagination">
                    <!-- Populated by JavaScript -->
                </div>

                <!-- Activity Log Section -->
                <div class="activity-log">
                     <div class="accordion-header">
                        <span>Recent Activity Log</span>
                        <ion-icon name="chevron-down-outline"></ion-icon> <!-- Using Ionicon -->
                    </div>
                    <div class="accordion-content">
                        <!-- Activity items added dynamically or statically -->
                         <div class="activity-item">
                            <div class="activity-icon"><ion-icon name="person-add-outline"></ion-icon></div>
                            <div class="activity-details">
                                <div>John Doe added new admin Jane Smith</div>
                                <div class="activity-time">Today, 9:32 AM</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon"><ion-icon name="create-outline"></ion-icon></div>
                            <div class="activity-details">
                                <div>John Doe updated admin Bob Johnson's role</div>
                                <div class="activity-time">Yesterday, 3:45 PM</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon"><ion-icon name="log-in-outline"></ion-icon></div>
                            <div class="activity-details">
                                <div>Jane Smith logged in to the admin panel</div>
                                <div class="activity-time">Yesterday, 10:12 AM</div>
                            </div>
                        </div>
                    </div>
                </div>

            </div> <!-- End .admin-content-area -->


            <!-- Add/Edit Admin Form (Hidden Initially) -->
             <form id="add-admin-form" novalidate> <!-- novalidate prevents browser default validation -->
                <input type="hidden" id="edit-admin-id" value=""> <!-- Hidden field for edit ID -->
                <div class="form-header">
                    <h2 id="form-title">Add New Administrator</h2>
                    <button type="button" class="form-close" aria-label="Close Form">&times;</button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        <input type="text" id="name" name="name" required>
                        <div id="name-error" class="error-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" required>
                        <div id="email-error" class="error-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" required>
                        <div id="username-error" class="error-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="role">Role</label>
                        <select id="role" name="role" required>
                            <option value="">Select Role</option>
                            <option value="superadmin">Super Admin</option>
                            <option value="contentmanager">Content Manager</option>
                            <option value="membermanager">Member Manager</option>
                            <option value="schedulemanager">Schedule Manager</option>
                        </select>
                        <div id="role-error" class="error-message"></div>
                    </div>
                     <div class="form-group">
                        <label for="password">Password</label>
                        <div class="password-container">
                            <input type="password" id="password" name="password" required>
                            <button type="button" class="toggle-password" aria-label="Toggle Password Visibility">
                               <ion-icon name="eye-outline"></ion-icon>
                            </button>
                        </div>
                        <div class="password-strength">
                            <span id="password-strength-text">Password strength</span>
                            <div class="strength-meter"><div class="strength-meter-fill" id="strength-meter-fill"></div></div>
                        </div>
                        <div id="password-error" class="error-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">Confirm Password</label>
                         <div class="password-container">
                            <input type="password" id="confirm-password" name="confirm-password" required>
                             <button type="button" class="toggle-password" aria-label="Toggle Password Visibility">
                                <ion-icon name="eye-outline"></ion-icon>
                            </button>
                         </div>
                        <div id="confirm-password-error" class="error-message"></div>
                    </div>
                </div>

                <div class="permissions-container">
                    <div class="permissions-title">Permissions</div>
                    <div class="permissions-grid">
                        <!-- Permissions populated by JS or hardcoded if static -->
                         <div class="permission-item"><label class="custom-checkbox"><input type="checkbox" name="permissions[]" value="dashboard"><span class="checkmark"></span></label><label>Dashboard</label></div>
                         <div class="permission-item"><label class="custom-checkbox"><input type="checkbox" name="permissions[]" value="admins"><span class="checkmark"></span></label><label>Admins</label></div>
                         <div class="permission-item"><label class="custom-checkbox"><input type="checkbox" name="permissions[]" value="users"><span class="checkmark"></span></label><label>Users</label></div>
                         <div class="permission-item"><label class="custom-checkbox"><input type="checkbox" name="permissions[]" value="content"><span class="checkmark"></span></label><label>Content</label></div>
                         <div class="permission-item"><label class="custom-checkbox"><input type="checkbox" name="permissions[]" value="settings"><span class="checkmark"></span></label><label>Settings</label></div>
                         <div class="permission-item"><label class="custom-checkbox"><input type="checkbox" name="permissions[]" value="reports"><span class="checkmark"></span></label><label>Reports</label></div>
                    </div>
                     <div id="permissions-error" class="error-message"></div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn cancel-btn" id="cancel-form">Cancel</button>
                    <button type="submit" class="btn save-btn">Save Admin</button>
                </div>
            </form>


            <!-- Modals -->
            <!-- Delete Confirmation Modal -->
            <div id="delete-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Confirm Deletion</h2>
                        <button class="close-button" data-action="close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete this administrator? This action cannot be undone.</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn cancel-btn" id="cancel-delete">Cancel</button>
                        <button class="btn delete-btn" id="confirm-delete">Delete</button>
                    </div>
                </div>
            </div>

            <!-- Change Password Modal -->
            <div id="change-password-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Change Password for <span id="change-pass-admin-name">Admin</span></h2>
                        <button class="close-button" data-action="close">&times;</button>
                    </div>
                    <form id="change-password-form" novalidate>
                        <div class="modal-body">
                               <div class="form-group">
                                <label for="new-password-modal">New Password</label>
                                <div class="password-container">
                                    <input type="password" id="new-password-modal" name="new-password" required>
                                    <button type="button" class="toggle-password" aria-label="Toggle Password Visibility">
                                        <ion-icon name="eye-outline"></ion-icon>
                                    </button>
                                </div>
                                <div class="password-strength">
                                    <span id="new-password-strength-text">Password strength</span>
                                    <div class="strength-meter"><div class="strength-meter-fill" id="new-strength-meter-fill"></div></div>
                                </div>
                                 <div id="new-password-modal-error" class="error-message"></div>
                            </div>
                            <div class="form-group">
                                <label for="confirm-new-password-modal">Confirm New Password</label>
                                <div class="password-container">
                                    <input type="password" id="confirm-new-password-modal" name="confirm-new-password" required>
                                     <button type="button" class="toggle-password" aria-label="Toggle Password Visibility">
                                        <ion-icon name="eye-outline"></ion-icon>
                                    </button>
                                </div>
                                <div id="confirm-new-password-modal-error" class="error-message"></div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn cancel-btn" id="cancel-password-change">Cancel</button>
                            <button type="submit" class="btn save-btn" id="confirm-password-change">Update Password</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Standard Sign Out Modal -->
            <div id="signOutModal" class="modal">
                <div class="modal-content">
                  <div class="modal-header">
                    <h2 class="modal-title">Sign Out</h2>
                    <!-- <button class="close-button" data-action="close">&times;</button> -->
                  </div>
                  <div class="modal-body"><p>Are you sure you want to sign out?</p></div>
                  <div class="modal-footer sign-out-actions">
                    <button class="modal-button no-button" id="signOutNo">No</button>
                    <button class="modal-button yes-button" id="signOutYes">Yes</button>
                  </div>
                </div>
            </div>

            <!-- Toast Notification -->
            <div class="toast" id="toast">
                <span id="toast-message"></span>
                <button class="close-toast" aria-label="Close Toast">&times;</button>
            </div>

        </div> <!-- End .main -->
    </div> <!-- End .container-fluid -->

 <!-- =========== Scripts =========  -->
 <script>
    document.addEventListener('DOMContentLoaded', function() {

        // =============== Navigation & Top Bar Logic (Standard) ===============
        const navigation = document.querySelector(".navigation");
        const main = document.querySelector(".main");
        const toggle = document.querySelector(".toggle");
        const listItems = document.querySelectorAll(".navigation li");

        if (toggle && navigation && main) {
            toggle.onclick = () => {
                navigation.classList.toggle("active");
                main.classList.toggle("active");
            };
        }
        listItems.forEach(item => item.addEventListener("click", function() {
             listItems.forEach(li => li.classList.remove("hovered"));
             this.classList.add("hovered");
        }));

        // Top Bar Search
        const searchInput = document.getElementById('search-input');
        const searchResultsDiv = document.getElementById('search-results');
        const siteSearchData = [ /* Add relevant search items */ { name:"Add Admin", action: () => document.getElementById('add-admin-button').click() }, { name:"John Doe", action: () => { /* filter? */ } }, { name:"Settings", link:"adminsettings.html" } ];
        if(searchInput && searchResultsDiv) {
            searchInput.addEventListener('input', function() {
                const term = this.value.toLowerCase().trim();
                const results = siteSearchData.filter(item => term && item.name.toLowerCase().includes(term));
                displaySearchResults(results);
            });
             const searchIcon = searchInput.closest('label')?.querySelector('ion-icon'); // Use optional chaining
             if(searchIcon) searchIcon.onclick = () => searchInput.focus();
        }
        function displaySearchResults(results) {
            searchResultsDiv.innerHTML = '';
            if (results.length > 0) {
                const ul = document.createElement('ul');
                results.forEach(result => {
                    const li = document.createElement('li');
                    li.textContent = result.name;
                    li.onclick = () => {
                        searchInput.value = result.name;
                        searchResultsDiv.style.display = 'none';
                        if (result.link && result.link !== "#") window.location.href = result.link;
                        else if (result.action) result.action();
                    };
                    ul.appendChild(li);
                });
                searchResultsDiv.appendChild(ul);
                searchResultsDiv.style.display = 'block';
            } else {
                searchResultsDiv.style.display = 'none';
            }
        }

         // Mail Dropdown
        const mailIconInbox = document.getElementById('mail-icon-inbox');
        const unreadMailBadge = document.getElementById('unread-mail-badge');
        const inboxPreview = document.getElementById('inbox-preview');
        let hasUnreadMail = true; // Example
        if (mailIconInbox && unreadMailBadge && inboxPreview) {
            const updateMailBadge = () => { unreadMailBadge.style.display = hasUnreadMail ? 'block' : 'none'; }
            updateMailBadge();
            mailIconInbox.addEventListener('click', (e) => {
                e.stopPropagation();
                inboxPreview.style.display = inboxPreview.style.display === 'block' ? 'none' : 'block';
                if (document.getElementById('notifications-dropdown')) document.getElementById('notifications-dropdown').style.display = 'none';
                if (hasUnreadMail && inboxPreview.style.display === 'block') { hasUnreadMail = false; updateMailBadge(); }
            });
        }

         // Notification Dropdown
        const notificationIcon = document.getElementById('notification-icon');
        const notificationBadge = document.getElementById('notification-badge');
        const notificationsDropdown = document.getElementById('notifications-dropdown');
        let hasNewNotifications = true; // Example
         if (notificationIcon && notificationBadge && notificationsDropdown) {
             const updateNotifBadge = () => { notificationBadge.style.display = hasNewNotifications ? 'block' : 'none'; }
             updateNotifBadge();
             notificationIcon.addEventListener('click', (e) => {
                e.stopPropagation();
                notificationsDropdown.style.display = notificationsDropdown.style.display === 'block' ? 'none' : 'block';
                 if (inboxPreview) inboxPreview.style.display = 'none';
                if (hasNewNotifications && notificationsDropdown.style.display === 'block') { hasNewNotifications = false; updateNotifBadge(); }
             });
         }

        // Hide dropdowns/search results on outside click
         document.addEventListener('click', (event) => {
            if (searchResultsDiv && !event.target.closest('.search-container')) searchResultsDiv.style.display = 'none';
            if (inboxPreview && !event.target.closest('.mail-container')) inboxPreview.style.display = 'none';
            if (notificationsDropdown && !event.target.closest('.notification-container')) notificationsDropdown.style.display = 'none';
        });

        // =============== Modal Helper Functions ===============
        function showModal(modalElement) {
            if(modalElement) modalElement.classList.add('show');
        }
        function hideModal(modalElement) {
            if(modalElement) modalElement.classList.remove('show');
        }
         function showToast(message, type = "info") { // success, error, warning, info
            const toast = document.getElementById("toast");
            const toastMessage = document.getElementById("toast-message");
            if (!toast || !toastMessage) return;

            toast.className = "toast show"; // Reset classes and add show
            toast.classList.add(type);
            toastMessage.textContent = message;

            // Auto hide after 5 seconds
            setTimeout(() => {
                toast.classList.remove("show");
            }, 5000);
        }

        // =============== Admin Management Specific Logic ===============
        // Sample data (replace with actual data fetching/management)
        let adminData = [ // Use let to allow modification
            { id: 1, name: "John Doe", email: "john@example.com", username: "johndoe", role: "superadmin", status: "active", lastLogin: "2023-08-10T14:32:45Z", permissions: ["dashboard", "admins", "users", "content", "settings", "reports", "activity"] },
            { id: 2, name: "Jane Smith", email: "jane@example.com", username: "janesmith", role: "contentmanager", status: "active", lastLogin: "2023-08-09T09:15:22Z", permissions: ["dashboard", "content"] },
            { id: 3, name: "Bob Johnson", email: "bob@example.com", username: "bobjohnson", role: "membermanager", status: "inactive", lastLogin: "2023-07-28T16:41:10Z", permissions: ["dashboard", "users"] }
        ];

        // DOM elements
        const adminListBody = document.querySelector("#admin-list tbody");
        const pagination = document.getElementById("pagination");
        const addAdminButton = document.getElementById("add-admin-button");
        const addAdminForm = document.getElementById("add-admin-form");
        const deleteModal = document.getElementById("delete-modal");
        const changePasswordModal = document.getElementById("change-password-modal");
        const changePasswordForm = document.getElementById("change-password-form");
        const toast = document.getElementById("toast");
        const adminSearch = document.getElementById("admin-search");
        const statusFilter = document.getElementById("status-filter");
        const roleFilter = document.getElementById("role-filter");
        const bulkActionsContainer = document.getElementById("bulk-actions");
        const selectAllCheckbox = document.getElementById("select-all");
        const accordionHeader = document.querySelector(".accordion-header");
        const accordionContent = document.querySelector(".accordion-content");
        const formTitle = document.getElementById("form-title");
        const editAdminIdInput = document.getElementById("edit-admin-id");
        const passwordInput = document.getElementById("password");
        const confirmPasswordInput = document.getElementById("confirm-password");
        const strengthMeterFill = document.getElementById("strength-meter-fill");
        const strengthText = document.getElementById("password-strength-text");
        const newPasswordModalInput = document.getElementById("new-password-modal");
        const confirmNewPasswordModalInput = document.getElementById("confirm-new-password-modal");
        const newStrengthMeterFill = document.getElementById("new-strength-meter-fill");
        const newStrengthText = document.getElementById("new-password-strength-text");


        // State Variables
        let currentPage = 1;
        const itemsPerPage = 10;
        let filteredData = [...adminData];
        let sortColumn = null;
        let sortOrder = 'asc'; // 'asc' or 'desc'

        // --- Main Functions ---

        function renderAdminTable() {
             if (!adminListBody) return;
             adminListBody.innerHTML = "";

             // Apply sorting before pagination
             sortData();

             const startIndex = (currentPage - 1) * itemsPerPage;
             const endIndex = startIndex + itemsPerPage;
             const currentData = filteredData.slice(startIndex, endIndex);

             if (currentData.length === 0) {
                 const tr = document.createElement("tr");
                 tr.innerHTML = `<td colspan="8" style="text-align: center; padding: 20px;">No administrators found matching criteria.</td>`;
                 adminListBody.appendChild(tr);
             } else {
                 currentData.forEach(admin => {
                     const tr = document.createElement("tr");
                     tr.dataset.id = admin.id; // Add data-id to row

                     const lastLoginDate = admin.lastLogin === "Never" ? "Never" : new Date(admin.lastLogin);
                     const formattedDate = admin.lastLogin === "Never" ? "Never" : `${lastLoginDate.toLocaleDateString()} ${lastLoginDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;

                     const roleDisplayMap = { 'superadmin': 'Super Admin', 'contentmanager': 'Content Manager', 'membermanager': 'Member Manager', 'schedulemanager': 'Schedule Manager' };
                     const displayRole = roleDisplayMap[admin.role] || admin.role.charAt(0).toUpperCase() + admin.role.slice(1);

                     tr.innerHTML = `
                         <td class="checkbox-cell">
                             <label class="custom-checkbox">
                                 <input type="checkbox" class="admin-checkbox" data-id="${admin.id}">
                                 <span class="checkmark"></span>
                             </label>
                         </td>
                         <td data-title="Name">${admin.name}</td>
                         <td data-title="Email">${admin.email}</td>
                         <td data-title="Username">${admin.username}</td>
                         <td data-title="Role">${displayRole}</td>
                         <td data-title="Status"><span class="status-badge ${admin.status}">${admin.status.charAt(0).toUpperCase() + admin.status.slice(1)}</span></td>
                         <td data-title="Last Login">${formattedDate}</td>
                         <td data-title="Actions">
                             <div class="actions-container">
                                 <button class="btn edit-btn icon-btn edit-admin" data-id="${admin.id}" title="Edit Admin">
                                     <ion-icon name="pencil-outline"></ion-icon> Edit
                                 </button>
                                 <button class="btn change-password-btn icon-btn change-password" data-id="${admin.id}" title="Change Password">
                                     <ion-icon name="lock-closed-outline"></ion-icon> Password
                                 </button>
                                 <button class="btn delete-btn icon-btn delete-admin" data-id="${admin.id}" title="Delete Admin">
                                     <ion-icon name="trash-outline"></ion-icon> Delete
                                 </button>
                             </div>
                         </td>
                     `;
                     adminListBody.appendChild(tr);
                 });
             }
             renderPagination();
             updateBulkActions(); // Ensure bulk actions visibility is correct
             attachRowEventListeners(); // Attach listeners after rendering rows
         }

         function attachRowEventListeners() {
             // Event listeners for buttons within the table rows (delegation is better for performance but direct is simpler here)
            document.querySelectorAll('.edit-admin').forEach(button => {
                // Remove previous listener if any to prevent duplicates
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                newButton.addEventListener('click', function() {
                    const adminId = parseInt(this.getAttribute('data-id'));
                    editAdmin(adminId);
                });
            });
            document.querySelectorAll('.change-password').forEach(button => {
                 const newButton = button.cloneNode(true);
                 button.parentNode.replaceChild(newButton, button);
                newButton.addEventListener('click', function() {
                    const adminId = parseInt(this.getAttribute('data-id'));
                    openChangePasswordModal(adminId);
                });
            });
            document.querySelectorAll('.delete-admin').forEach(button => {
                 const newButton = button.cloneNode(true);
                 button.parentNode.replaceChild(newButton, button);
                newButton.addEventListener('click', function() {
                    const adminId = parseInt(this.getAttribute('data-id'));
                    openDeleteModal(adminId);
                });
            });
            document.querySelectorAll('.admin-checkbox').forEach(checkbox => {
                 const newCheckbox = checkbox.cloneNode(true);
                 checkbox.parentNode.replaceChild(newCheckbox, checkbox);
                newCheckbox.addEventListener('change', updateBulkActions);
            });
        }

        function renderPagination() {
            if (!pagination) return;
            pagination.innerHTML = "";
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            if (totalPages <= 1) return; // Don't show pagination if only one page

            // Previous button
            const prevButton = document.createElement("button");
            prevButton.innerHTML = "&laquo;"; // Previous arrow
            prevButton.title = "Previous Page";
            prevButton.disabled = currentPage === 1;
            prevButton.addEventListener("click", () => { changePage(currentPage - 1); });
            pagination.appendChild(prevButton);

            // Page buttons (simplified view for many pages)
             const maxPagesToShow = 5;
             let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
             let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);
             if (endPage - startPage + 1 < maxPagesToShow) {
                 startPage = Math.max(1, endPage - maxPagesToShow + 1);
             }

             if (startPage > 1) {
                 const firstButton = document.createElement("button");
                 firstButton.innerHTML = "1";
                 firstButton.addEventListener("click", () => { changePage(1); });
                 pagination.appendChild(firstButton);
                 if (startPage > 2) {
                      const ellipsis = document.createElement("button");
                      ellipsis.innerHTML = "...";
                      ellipsis.disabled = true;
                      pagination.appendChild(ellipsis);
                 }
             }

            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement("button");
                pageButton.innerHTML = i;
                pageButton.classList.toggle("active", i === currentPage);
                pageButton.addEventListener("click", () => { changePage(i); });
                pagination.appendChild(pageButton);
            }

             if (endPage < totalPages) {
                 if (endPage < totalPages - 1) {
                     const ellipsis = document.createElement("button");
                      ellipsis.innerHTML = "...";
                      ellipsis.disabled = true;
                      pagination.appendChild(ellipsis);
                 }
                  const lastButton = document.createElement("button");
                 lastButton.innerHTML = totalPages;
                 lastButton.addEventListener("click", () => { changePage(totalPages); });
                 pagination.appendChild(lastButton);
             }


            // Next button
            const nextButton = document.createElement("button");
            nextButton.innerHTML = "&raquo;"; // Next arrow
             nextButton.title = "Next Page";
            nextButton.disabled = currentPage === totalPages;
            nextButton.addEventListener("click", () => { changePage(currentPage + 1); });
            pagination.appendChild(nextButton);
        }

        function changePage(newPage) {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            if (newPage >= 1 && newPage <= totalPages) {
                 currentPage = newPage;
                 renderAdminTable();
                 // Optional: scroll to top of table
                 // document.getElementById('admin-list')?.scrollIntoView({ behavior: 'smooth' });
            }
        }


        function updateStatistics() {
            document.getElementById("total-admins").textContent = adminData.length;
            document.getElementById("active-admins").textContent = adminData.filter(admin => admin.status === "active").length;
            document.getElementById("super-admins").textContent = adminData.filter(admin => admin.role === "superadmin").length;
        }

        function filterAndSortAdmins() {
            const searchTerm = adminSearch.value.toLowerCase();
            const statusValue = statusFilter.value;
            const roleValue = roleFilter.value;

            filteredData = adminData.filter(admin => {
                const matchesSearch = !searchTerm ||
                    admin.name.toLowerCase().includes(searchTerm) ||
                    admin.email.toLowerCase().includes(searchTerm) ||
                    admin.username.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusValue || admin.status === statusValue;
                const matchesRole = !roleValue || admin.role === roleValue;
                return matchesSearch && matchesStatus && matchesRole;
            });

            currentPage = 1; // Reset to first page after filtering/sorting
            renderAdminTable(); // This will call sortData internally now
        }

         function sortData() {
            if (!sortColumn) return; // No sorting applied yet

             filteredData.sort((a, b) => {
                let valueA = a[sortColumn];
                let valueB = b[sortColumn];

                 // Handle date sorting for lastLogin
                 if (sortColumn === 'lastLogin') {
                     // Treat "Never" as earliest/latest depending on sort order
                     const dateA = valueA === "Never" ? (sortOrder === 'asc' ? -Infinity : Infinity) : new Date(valueA).getTime();
                     const dateB = valueB === "Never" ? (sortOrder === 'asc' ? -Infinity : Infinity) : new Date(valueB).getTime();
                     return sortOrder === 'asc' ? dateA - dateB : dateB - dateA;
                 }

                // Handle string comparison (case-insensitive)
                if (typeof valueA === "string") {
                    valueA = valueA.toLowerCase();
                    valueB = valueB.toLowerCase();
                }

                if (valueA < valueB) return sortOrder === "asc" ? -1 : 1;
                if (valueA > valueB) return sortOrder === "asc" ? 1 : -1;
                return 0;
            });
        }


        function setupSorting() {
            const sortableColumns = document.querySelectorAll("#admin-list thead th.sortable");
            sortableColumns.forEach(column => {
                column.addEventListener("click", function() {
                    const columnKey = this.getAttribute("data-sort");

                    // Determine new sort order
                    if (sortColumn === columnKey) {
                        sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
                    } else {
                        sortColumn = columnKey;
                        sortOrder = 'asc';
                    }

                    // Update header classes
                    sortableColumns.forEach(col => col.classList.remove('asc', 'desc'));
                    this.classList.add(sortOrder);

                    // Re-render table
                    renderAdminTable();
                });
            });
        }

         function updateBulkActions() {
            const checkedBoxes = document.querySelectorAll('.admin-checkbox:checked');
            const selectedCount = checkedBoxes.length;
            const selectedCountSpan = document.getElementById('selected-count');
            const bulkActionsDiv = document.getElementById('bulk-actions');

             if (selectedCountSpan) selectedCountSpan.textContent = selectedCount;

            if (bulkActionsDiv) {
                 bulkActionsDiv.style.display = selectedCount > 0 ? 'flex' : 'none';
            }
         }

        function applyBulkAction() {
            const action = document.getElementById('bulk-action-select').value;
            if (!action) {
                showToast("Please select an action.", "warning");
                return;
            }
            const selectedIds = Array.from(document.querySelectorAll('.admin-checkbox:checked'))
                                     .map(checkbox => parseInt(checkbox.getAttribute('data-id')));
            if (selectedIds.length === 0) {
                showToast("No admins selected.", "warning");
                return;
            }

            let actionText = "";
            let actionPerformed = false;

            // --- IMPORTANT: Add confirmation for delete ---
             if (action === 'delete') {
                if (!confirm(`Are you sure you want to delete ${selectedIds.length} selected administrator(s)? This cannot be undone.`)) {
                    return; // Stop if user cancels
                }
            }
            // ---------------------------------------------

            selectedIds.forEach(id => {
                const adminIndex = adminData.findIndex(admin => admin.id === id);
                if (adminIndex === -1) return;

                switch (action) {
                    case 'activate':
                        if (adminData[adminIndex].status !== 'active') {
                            adminData[adminIndex].status = 'active';
                            actionPerformed = true;
                        }
                        actionText = "activated";
                        break;
                    case 'deactivate':
                         if (adminData[adminIndex].status !== 'inactive') {
                            adminData[adminIndex].status = 'inactive';
                            actionPerformed = true;
                        }
                        actionText = "deactivated";
                        break;
                    case 'delete':
                        adminData.splice(adminIndex, 1);
                        actionPerformed = true;
                        actionText = "deleted";
                        break;
                }
            });

             if (actionPerformed) {
                updateStatistics();
                filterAndSortAdmins(); // Use combined function
                showToast(`Selected administrators ${actionText} successfully!`, "success");
                if(selectAllCheckbox) selectAllCheckbox.checked = false;
                updateBulkActions(); // Hide bulk actions again
                 document.getElementById('bulk-action-select').value = ""; // Reset select
            } else {
                showToast("No changes applied (admins might already be in the selected state).", "warning");
            }
        }

         function checkPasswordStrength(inputElement, meterFillId, strengthTextId) {
            const password = inputElement.value;
            const meterFill = document.getElementById(meterFillId);
            const strengthText = document.getElementById(strengthTextId);
            if(!meterFill || !strengthText) return;

            meterFill.className = 'strength-meter-fill'; // Reset class
            meterFill.style.width = "0%"; // Reset width

            if (password.length === 0) {
                strengthText.textContent = "Password strength";
                return;
            }

            let strength = 0;
            if (password.length >= 8) strength++;
            if (password.length >= 12) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++; // Symbols

             if (strength <= 2) {
                meterFill.classList.add('weak'); strengthText.textContent = "Weak"; meterFill.style.width = "25%";
            } else if (strength <= 4) {
                meterFill.classList.add('medium'); strengthText.textContent = "Medium"; meterFill.style.width = "50%";
            } else if (strength <= 5) {
                meterFill.classList.add('strong'); strengthText.textContent = "Strong"; meterFill.style.width = "75%";
            } else {
                meterFill.classList.add('very-strong'); strengthText.textContent = "Very Strong"; meterFill.style.width = "100%";
            }
        }

        function validateForm(isEdit = false) {
            let isValid = true;
            clearErrors();

            const name = document.getElementById("name");
            const email = document.getElementById("email");
            const username = document.getElementById("username");
            const role = document.getElementById("role");
            const password = document.getElementById("password");
            const confirmPassword = document.getElementById("confirm-password");
            const permissionsCheckboxes = document.querySelectorAll('input[name="permissions[]"]:checked');

            if (!name.value.trim()) isValid = showError(name, "Name is required");
            if (!email.value.trim()) isValid = showError(email, "Email is required");
            else if (!/\S+@\S+\.\S+/.test(email.value)) isValid = showError(email, "Invalid email format");
            if (!username.value.trim()) isValid = showError(username, "Username is required");
            else if (username.value.length < 4) isValid = showError(username, "Username minimum 4 characters");
            if (!role.value) isValid = showError(role, "Please select a role");

             // Password validation only required when adding, or if filled when editing
            if (!isEdit || password.value) {
                 if (!password.value) isValid = showError(password, "Password is required");
                 else if (password.value.length < 8) isValid = showError(password, "Password minimum 8 characters");
                 if (!confirmPassword.value) isValid = showError(confirmPassword, "Please confirm password");
                 else if (password.value !== confirmPassword.value) isValid = showError(confirmPassword, "Passwords do not match");
            }

             if (permissionsCheckboxes.length === 0) {
                const permissionsErrorDiv = document.getElementById("permissions-error");
                if(permissionsErrorDiv) {
                    permissionsErrorDiv.textContent = "At least one permission must be selected.";
                    isValid = false;
                }
             }


            return isValid;
        }

         function showError(element, message) {
            const errorId = `${element.id}-error`;
            const errorElement = document.getElementById(errorId);
            if (errorElement) {
                errorElement.textContent = message;
            }
             // Add error class to input/select for styling if needed
             // element.classList.add('input-error');
            return false; // To make chaining easier in validation
        }

        function clearErrors() {
            document.querySelectorAll(".error-message").forEach(el => el.textContent = "");
             // Remove error classes if added
             // document.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));
        }

        function handleFormSubmit(event) {
            event.preventDefault();
             const isEdit = !!editAdminIdInput.value; // Check if we are editing

            if (validateForm(isEdit)) {
                const adminId = isEdit ? parseInt(editAdminIdInput.value) : (adminData.length > 0 ? Math.max(...adminData.map(a => a.id)) + 1 : 1);
                const name = document.getElementById("name").value.trim();
                const emailVal = document.getElementById("email").value.trim(); // Renamed variable
                const usernameVal = document.getElementById("username").value.trim(); // Renamed variable
                const roleVal = document.getElementById("role").value; // Renamed variable
                const passwordVal = document.getElementById("password").value; // Renamed variable
                const permissions = Array.from(document.querySelectorAll('input[name="permissions[]"]:checked')).map(cb => cb.value);

                const adminDataPayload = {
                     id: adminId,
                     name: name,
                     email: emailVal,
                     username: usernameVal,
                     role: roleVal,
                     permissions: permissions,
                     // Keep status and lastLogin as they are during edit, or set defaults for add
                     status: isEdit ? adminData.find(a => a.id === adminId).status : "active",
                     lastLogin: isEdit ? adminData.find(a => a.id === adminId).lastLogin : "Never"
                 };

                 if (isEdit) {
                     // Update existing admin
                     const index = adminData.findIndex(a => a.id === adminId);
                     if (index !== -1) {
                         // Only update password if a new one was entered
                         if (passwordVal) {
                             // In real app, hash this password before saving
                             adminDataPayload.password = passwordVal; // Store plain for demo, HASH IN REAL APP
                         } else {
                              // Retain old password hash (not possible in this demo structure)
                             // Or simply don't update the password field on the backend
                         }
                         adminData[index] = { ...adminData[index], ...adminDataPayload }; // Merge updates
                         showToast("Administrator updated successfully!", "success");
                     }
                 } else {
                     // Add new admin
                     // In real app, hash this password before saving
                      adminDataPayload.password = passwordVal; // Store plain for demo, HASH IN REAL APP
                     adminData.push(adminDataPayload);
                     showToast("Administrator added successfully!", "success");
                 }

                addAdminForm.style.display = "none";
                addAdminForm.reset();
                editAdminIdInput.value = ""; // Clear edit ID
                 document.getElementById('form-title').textContent = "Add New Administrator"; // Reset title
                 // Reset password field requirement if it was removed for edit
                document.getElementById('password').required = true;
                document.getElementById('confirm-password').required = true;
                document.getElementById('password').placeholder = "";
                document.getElementById('confirm-password').placeholder = "";

                updateStatistics();
                filterAndSortAdmins(); // Use combined function
            }
        }

        function editAdmin(adminId) {
             const admin = adminData.find(a => a.id === adminId);
             if (!admin) return;

             clearErrors(); // Clear previous errors
             formTitle.textContent = "Edit Administrator";
             editAdminIdInput.value = admin.id;
             document.getElementById("name").value = admin.name;
             document.getElementById("email").value = admin.email;
             document.getElementById("username").value = admin.username;
             document.getElementById("role").value = admin.role;

              // Clear and check permissions
             document.querySelectorAll('input[name="permissions[]"]').forEach(cb => {
                 cb.checked = admin.permissions?.includes(cb.value) ?? false;
             });

             // Make password optional for editing
             passwordInput.value = "";
             confirmPasswordInput.value = "";
             passwordInput.required = false;
             confirmPasswordInput.required = false;
             passwordInput.placeholder = "Leave blank to keep current password";
             confirmPasswordInput.placeholder = ""; // Confirm not needed if main is blank
             checkPasswordStrength(passwordInput); // Update meter based on empty field


             addAdminForm.style.display = "block";
             addAdminForm.scrollIntoView({ behavior: 'smooth' }); // Scroll form into view
         }

        function openDeleteModal(adminId) {
            const admin = adminData.find(a => a.id === adminId);
            if (!admin) return;
            const confirmButton = document.getElementById("confirm-delete");
            confirmButton.dataset.id = adminId; // Store ID on button
            deleteModal.querySelector(".modal-body p").textContent = `Are you sure you want to delete ${admin.name} (${admin.username})? This action cannot be undone.`;
            showModal(deleteModal);
        }

        function confirmDeleteAdmin() {
             const adminId = parseInt(document.getElementById("confirm-delete").dataset.id);
             const adminIndex = adminData.findIndex(admin => admin.id === adminId);
             if (adminIndex !== -1) {
                 adminData.splice(adminIndex, 1);
                 updateStatistics();
                 filterAndSortAdmins();
                 showToast("Administrator deleted successfully!", "success");
             }
             hideModal(deleteModal);
         }

        function openChangePasswordModal(adminId) {
            const admin = adminData.find(a => a.id === adminId);
            if (!admin) return;
            document.getElementById("change-pass-admin-name").textContent = admin.name;
            document.getElementById("confirm-password-change").dataset.id = adminId;
            // Reset fields
            changePasswordForm.reset();
            clearChangePasswordErrors();
            checkPasswordStrength(newPasswordModalInput, 'new-strength-meter-fill', 'new-password-strength-text'); // Reset meter

            showModal(changePasswordModal);
        }

         function confirmPasswordChange(event) {
            event.preventDefault(); // Prevent default form submission
             const adminId = parseInt(document.getElementById("confirm-password-change").dataset.id);
             const newPassword = newPasswordModalInput.value;
             const confirmNewPassword = confirmNewPasswordModalInput.value;

             clearChangePasswordErrors();
             let isValid = true;

             if (!newPassword) isValid = showError(newPasswordModalInput, "New password is required", true);
             else if (newPassword.length < 8) isValid = showError(newPasswordModalInput, "Password minimum 8 characters", true);

             if (!confirmNewPassword) isValid = showError(confirmNewPasswordModalInput, "Please confirm new password", true);
             else if (newPassword !== confirmNewPassword) isValid = showError(confirmNewPasswordModalInput, "Passwords do not match", true);

             if (isValid) {
                 // Find admin and update password (HASH IN REAL APP)
                 const adminIndex = adminData.findIndex(a => a.id === adminId);
                 if (adminIndex !== -1) {
                     adminData[adminIndex].password = newPassword; // Store plain for demo
                     console.log(`Password changed for admin ID: ${adminId}`);
                     showToast("Password updated successfully!", "success");
                     hideModal(changePasswordModal);
                 } else {
                      showToast("Error: Admin not found.", "error");
                 }
             }
         }

        function clearChangePasswordErrors() {
             showError(newPasswordModalInput, "", true); // Clear error messages
             showError(confirmNewPasswordModalInput, "", true);
        }
        // Overload showError slightly for modal password validation
        function showError(element, message, isModal = false) {
            const errorId = isModal ? `${element.id}-error` : `${element.id}-error`; // Can simplify if IDs are unique
            const errorElement = document.getElementById(errorId);
            if (errorElement) {
                errorElement.textContent = message;
            }
            return false; // Indicate validation failure
        }


        function setupTogglePasswordVisibility() {
            document.querySelectorAll('.toggle-password').forEach(button => {
                button.addEventListener('click', function() {
                    const input = this.previousElementSibling; // Assumes input is right before button
                    const icon = this.querySelector('ion-icon');
                    if (input.type === "password") {
                        input.type = "text";
                        icon.setAttribute('name', 'eye-off-outline');
                    } else {
                        input.type = "password";
                         icon.setAttribute('name', 'eye-outline');
                    }
                });
            });
        }

        // --- Event Listeners Setup ---
        function setupAdminPageEventListeners() {
            if(addAdminButton) addAdminButton.addEventListener("click", () => {
                formTitle.textContent = "Add New Administrator";
                editAdminIdInput.value = "";
                addAdminForm.reset();
                clearErrors();
                // Ensure password fields are required for adding
                passwordInput.required = true;
                confirmPasswordInput.required = true;
                 passwordInput.placeholder = "";
                 confirmPasswordInput.placeholder = "";
                checkPasswordStrength(passwordInput); // Reset meter
                addAdminForm.style.display = "block";
                 addAdminForm.scrollIntoView({ behavior: 'smooth' });
            });
            if(document.querySelector(".form-close")) document.querySelector(".form-close").addEventListener("click", () => { addAdminForm.style.display = "none"; });
            if(document.getElementById("cancel-form")) document.getElementById("cancel-form").addEventListener("click", () => { addAdminForm.style.display = "none"; });
            if(addAdminForm) addAdminForm.addEventListener("submit", handleFormSubmit);

            // Password strength listeners
            if(passwordInput) passwordInput.addEventListener("input", () => checkPasswordStrength(passwordInput, 'strength-meter-fill', 'password-strength-text'));
            if(newPasswordModalInput) newPasswordModalInput.addEventListener("input", () => checkPasswordStrength(newPasswordModalInput, 'new-strength-meter-fill', 'new-password-strength-text'));

            // Toggle password visibility
            setupTogglePasswordVisibility();

            // Modals close/cancel buttons
            document.querySelectorAll('.modal .close-button, .modal .cancel-btn').forEach(btn => {
                btn.addEventListener('click', () => hideModal(btn.closest('.modal')));
            });
            if(document.getElementById("cancel-delete")) document.getElementById("cancel-delete").addEventListener('click', () => hideModal(deleteModal));
            if(document.getElementById("confirm-delete")) document.getElementById("confirm-delete").addEventListener('click', confirmDeleteAdmin);
            if(document.getElementById("cancel-password-change")) document.getElementById("cancel-password-change").addEventListener('click', () => hideModal(changePasswordModal));
            if(changePasswordForm) changePasswordForm.addEventListener('submit', confirmPasswordChange);


            // Filters and Search
            if(adminSearch) adminSearch.addEventListener("input", filterAndSortAdmins);
            if(document.getElementById("search-button")) document.getElementById("search-button").addEventListener("click", filterAndSortAdmins); // Button trigger
            if(statusFilter) statusFilter.addEventListener("change", filterAndSortAdmins);
            if(roleFilter) roleFilter.addEventListener("change", filterAndSortAdmins);

            // Bulk Actions
            if(selectAllCheckbox) selectAllCheckbox.addEventListener("change", function() {
                document.querySelectorAll(".admin-checkbox").forEach(checkbox => { checkbox.checked = this.checked; });
                updateBulkActions();
            });
            if(document.getElementById("apply-bulk-action")) document.getElementById("apply-bulk-action").addEventListener("click", applyBulkAction);

            // Accordion
            if (accordionHeader && accordionContent) {
                accordionHeader.addEventListener("click", function() {
                    this.classList.toggle("active");
                    const icon = this.querySelector('ion-icon');
                    if (accordionContent.style.display === "block") {
                        accordionContent.style.display = "none";
                         if(icon) icon.setAttribute('name', 'chevron-down-outline');
                    } else {
                        accordionContent.style.display = "block";
                         if(icon) icon.setAttribute('name', 'chevron-up-outline');
                    }
                });
            }

             // Toast close button
             const closeToastButton = document.querySelector('.close-toast');
             if(closeToastButton && toast) {
                 closeToastButton.addEventListener('click', () => toast.classList.remove('show'));
             }
        }

        // --- Initialize ---
        updateStatistics();
        filterAndSortAdmins(); // Initial render includes filtering and default sort
        setupSorting(); // Setup column header sort listeners
        setupAdminPageEventListeners(); // Setup page specific listeners


        // =============== Sign Out Modal Logic (Standard) ===============
        const signOutLink = document.getElementById('signOutLink');
        const signOutModal = document.getElementById('signOutModal');
        const signOutYesButton = document.getElementById('signOutYes');
        const signOutNoButton = document.getElementById('signOutNo');

        if (signOutLink && signOutModal && signOutYesButton && signOutNoButton) {
            signOutLink.addEventListener('click', (event) => { event.preventDefault(); showModal(signOutModal); });
            signOutYesButton.addEventListener('click', () => { console.log("Signing out..."); window.location.href = 'index.html'; });
            signOutNoButton.addEventListener('click', () => hideModal(signOutModal));
        }

         // Close modals on outside click / Escape key
        window.addEventListener('click', function(event) {
            document.querySelectorAll('.modal.show').forEach(modal => {
                if (event.target === modal) {
                     hideModal(modal);
                }
            });
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === "Escape") {
                document.querySelectorAll('.modal.show').forEach(hideModal);
            }
        });

    }); // End DOMContentLoaded
 </script>

<!-- ====== ionicons ======= -->
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
</body>

</html>